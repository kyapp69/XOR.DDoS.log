<!DOCTYPE html>
<!-- saved from url=(0083)http://blog.malwaremustdie.org/2014/09/mmd-0028-2014-fuzzy-reversing-new-china.html -->
<html lang="en-us" class="gr__blog_malwaremustdie_org"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      MMD-0028-2014 - Linux/XOR.DDoS : Fuzzy reversing a new China ELF  · MalwareMustDie!
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/poole.css">
  <link rel="stylesheet" href="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/syntax.css">
  <link rel="stylesheet" href="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/blackdoc.css">
  <link rel="stylesheet" href="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/css">
  <link rel="stylesheet" href="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/css(1)">
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://blog.malwaremustdie.org/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="http://blog.malwaremustdie.org/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://blog.malwaremustdie.org/atom.xml">

<style></style></head>


<body class="layout-reverse" data-gr-c-s-loaded="true">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="http://blog.malwaremustdie.org/">
        <img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/MMD.JPG" alt="MalwareMustDie!" border="0">
        
        </a>
      </h1>
      <p class="lead">Semper legerent Salve Regina ante venatione malware</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="http://blog.malwaremustdie.org/">Home</a>
      <a class="sidebar-nav-item" href="http://blog.malwaremustdie.org/2017/">Blog Archives</a>
      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="http://blog.malwaremustdie.org/about.html">About</a>
          
        
      
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="http://blog.malwaremustdie.org/sendsample.html">Send Sample</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="http://blog.malwaremustdie.org/tangodown.html">Tango Down</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <a class="sidebar-nav-item" href="http://malwaremustdie.org/">Web Site</a>
      <a class="sidebar-nav-item" href="http://www.google.com/search?q=malwaremustdie&amp;tbm=nws&amp;start=0">News Search</a>
      <a class="sidebar-nav-item" href="https://www.google.com/search?q=malwaremustdie&amp;newwindow=1&amp;client=firefox-b&amp;biw=928&amp;bih=462&amp;source=lnt&amp;tbs=cdr%3A1%2Ccd_min%3A7%2F1%2F2012%2Ccd_max%3A6%2F10%2F2016&amp;tbm=#q=malwaremustdie&amp;newwindow=1&amp;tbs=cdr:1,cd_min:7/1/2012,cd_max:6/10/2016,sbd:1&amp;start=10">Web Search</a>
      <a class="sidebar-nav-item" href="http://malwaremustdie.imgur.com/">Images</a>
      <a class="sidebar-nav-item" href="https://www.youtube.com/playlist?list=PLSe6fLFf1YDX-2sog70220BchQmhVqQ75">Videos</a>
      <a class="sidebar-nav-item" href="http://pastebin.com/u/MalwareMustDie">Pastebin</a>
      <a class="sidebar-nav-item" href="http://code.google.com/p/malwaremustdie/">Codes</a>
      <a class="sidebar-nav-item" href="http://blog.malwaremustdie.org/2014/05/the-rule-to-share-malicious-codes-we.html">Disclaimer</a>
      <hr>
      <a class="sidebar-nav-item" href="http://blog.malwaremustdie.org/2016/11/linux-malware.html">Linux Malware</a>
      <a class="sidebar-nav-item" href="http://blog.malwaremustdie.org/2015/12/hall-of-shame.html">Hall of Shame</a>

      
      <div class="related">
        <!------Recent Posts------>
        <ul class="related-posts">
          
            <li>
                <a href="http://blog.malwaremustdie.org/2017/02/mmd-0062-2017-ssh-direct-tcp-forward-attack.html">MMD-0062-2017 - Credential harvesting by SSH Direct TCP Forward attack via IoT botnet
                  <small>27 Feb 2017</small>
                </a>
            </li>
          
            <li>
                <a href="http://blog.malwaremustdie.org/2016/11/mmd-0061-2016-emech-for-ddos.html">MMD-0061-2016 - EnergyMech 2.8 overkill mod
                  <small>28 Nov 2016</small>
                </a>
            </li>
          
            <li>
                <a href="http://blog.malwaremustdie.org/2016/11/linux-malware.html">Linux Malware Research List Updated
                  <small>22 Nov 2016</small>
                </a>
            </li>
          
            <li>
                <a href="http://blog.malwaremustdie.org/2016/10/mmd-0060-2016-linuxudpfker-and-chinaz.html">MMD-0060-2016 - Linux/UDPfker and ChinaZ threat today
                  <small>30 Oct 2016</small>
                </a>
            </li>
          
            <li>
                <a href="http://blog.malwaremustdie.org/2016/10/mmd-0059-2016-linuxirctelnet-new-ddos.html">MMD-0059-2016 - Linux/IRCTelnet (new Aidra) - A DDoS botnet aims IoT w/ IPv6 ready
                  <small>29 Oct 2016</small>
                </a>
            </li>
          
            <li>
                <a href="http://blog.malwaremustdie.org/2016/10/mmd-0058-2016-elf-linuxnyadrop.html">MMD-0058-2016 - Linux/NyaDrop - a linux MIPS IoT bad news
                  <small>14 Oct 2016</small>
                </a>
            </li>
          
            <li>
                <a href="http://blog.malwaremustdie.org/2016/09/mmd-0057-2016-new-elf-botnet-linuxluabot.html">MMD-0057-2016 - Linux/LuaBot - IoT botnet as service
                  <small>06 Sep 2016</small>
                </a>
            </li>
          
            <li>
                <a href="http://blog.malwaremustdie.org/2016/09/tango-down-ransomware.html">Tango down of Exploit Kit 3,917 domains served ransomware 
                  <small>02 Sep 2016</small>
                </a>
            </li>
          
            <li>
                <a href="http://blog.malwaremustdie.org/2016/08/mmd-0056-2016-linuxmirai-just.html">MMD-0056-2016 - Linux/Mirai, how an old ELF malcode is recycled.. 
                  <small>31 Aug 2016</small>
                </a>
            </li>
          
            <li>
                <a href="http://blog.malwaremustdie.org/2016/08/mmd-0054-2016-pnscan-elf-worm-that.html">  MMD-0055-2016 - Linux/PnScan ; ELF worm that still circles around
                  <small>24 Aug 2016</small>
                </a>
            </li>
          
        </ul>
      </div>

      <span class="sidebar-nav-item">Version: 0.0.2-1480291200unixfreaxjp</span>
    </nav>

    <p>© <a href="http://www.malwaremustdie.org/">MalwareMustDie</a>,NPO 2017. All rights reserved.<br>
       Built by <a href="https://jekyllrb.com/">Jekyll</a>, based on <a href="http://getpoole.com/">Poole</a> and <a href="http://jekyllthemes.org/themes/blackdoc/">BlackDoc</a> on <a href="http://freebsd.org/">FreeBSD</a>, 
       posts are in <a href="http://daringfireball.net/projects/markdown/">Markdown</a> and <a href="http://rouge.jneen.net/">Rouge</a> highlighter with templates coded in <a href="http://shopify.github.io/liquid/">Liquid</a>.
    </p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">MMD-0028-2014 - Linux/XOR.DDoS : Fuzzy reversing a new China ELF </h1>
  <span class="post-date">29 Sep 2014</span>
  <font color="yellow"><i>Sticky note: </i>The latest incident (<b>MMD-0033-2015</b>) we disclosed on ELF <b>Linux/XOR.DDoS</b> malware is here --&gt;[<a href="http://blog.malwaremustdie.org/2015/06/mmd-0033-2015-linuxxorddos-infection_23.html">LINK</a>]</font> <p><i>This research is detected &amp; solved by a hard work of MMD members. Credits are in the bottom of the post.</i><br><i>The case is on and malware infrastructure is mostly up &amp; alive, we don't want to be too details in writing because of that reason, we don't want to teach this crook of what they're lacking of by this post, yet this post necessary to raise awareness of this new emerged threat. Feel free to follow the process at will.</i> </p><p></p><h2>The infection</h2> <p>During the rush of #shellshock we saw another new threat emerged. We saw an attack log of one-liner shell script being injected via ssh connection. By the attack source+CNC IP and the payload, this looks like a China crook's new hack scheme to spread new ELF DDoS'er threat. This is spotted silently spread during the ‪#‎shellshock waves, noted: it was NOT using #shellshock exploit itself.   </p><p>The details of the attacker's trace in one-liner shell command is as per shown below:<br><a href="https://lh4.googleusercontent.com/-kuye4Jyn_B4/VCkINsVkV8I/AAAAAAAARDI/X1y51s1nI58/s1224/003.png"><img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/003.png"></a> </p><p>If we beautified it as per below we will see the obfuscation this shell script:<br><a href="https://lh4.googleusercontent.com/-lFPGvonfpwA/VCkIOxNzpdI/AAAAAAAARDk/4O1_GDFrPQw/s1720/006.png"><img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/006.png"></a><br>↑the marked mark is the point of all these code, to download the file 3502.rar from some defined host addresses.  </p><p>The mentioned RAR file itself is actually a shell script too:<br><a href="https://lh3.googleusercontent.com/-3rBVaDL7Hto/VCkLIs7j1_I/AAAAAAAARD0/KpCtC2iuHMA/s1556/007.png"><img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/007.png"></a> </p><p>You can read the codes here, no free ride copy/paste this time, since we have hard times with those false positives from antiviruses<br><a href="http://malwaremustdie.org/stat/008.png"><img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/008a.png"></a> </p><p>The <b><i>main()</i></b> function is explaining how this script works, read the comments we made (in purple colored words):<br><a href="https://lh3.googleusercontent.com/-RXv_AbiaBaI/VCkVtxAa1_I/AAAAAAAAREc/CRqE1W6LZwE/s1912/009.png"><img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/009.png"></a><br>Shortly. The blue color explaining the obfuscation strings saved in some variables. The yellow marked color words are functions to be executed, and the red color area is the main function of this script, to download and install a payload.  </p><p>The obfuscation used is in the <b><i>enc()</i></b> and <b><i>dec()</i></b> function (see that big pic codes) for encryption and decryption, by using the below code (I picked this one, the one used for decrypting) </p><pre class="brush: js">tr "[.0-9a-zA-Z\/\/\:]" "[a-zA-Z0-9\;-=+*\/]";</pre>They called it encryption, but is just a mere obfuscator using the character map translation in "tr". Below is the easy shell script I made to decode them:<br><a href="https://lh5.googleusercontent.com/-N1jgOLxx9_U/VCkINsNNokI/AAAAAAAARDQ/5sw97TYvLUE/s1576/002.png"><img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/002.png"></a><br>Below is the result:<br><a href="https://lh5.googleusercontent.com/-EKCo9KHTh6M/VCkIOlLpCXI/AAAAAAAARDo/2IloEbOmTqw/s984/005.png"><img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/005.png"></a><br>We'll see another 3502 file. And a bunch of the CNC used. Noted the username and password they use ;)  <p>If you permutated the URL with the payload name you will some ALIVE malware URLs like these: <a href="https://lh6.googleusercontent.com/-HTHY7yZ_-YU/VDuYswyDYdI/AAAAAAAARWA/xnS3PHMbGug/s1200/002.png"><img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/002(1).png"></a> </p><p>What is this thing? In short: It's a sophisticated &amp; well-thought ELF malware infection scheme, aiming Linux in multiple platform. It downloads, detect all parameter need to download the payload or source code of payload. It detected infected host's architecture, compiler. libraries together with sending sensitive information of the host, sent request to CNC to download the certain bins or to download resources to hack and then install the ELF binary.   </p><p>The POC of this hack is the payload below:<br><a href="https://lh6.googleusercontent.com/--79HIOdMwxY/VCkIObXzYII/AAAAAAAARDc/MnvVuSmUk1w/s1703/004.png"><img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/004.png"></a> </p><p></p><h2>The payload</h2> <p>The header looks very "fine": </p><pre class="brush: js">ELF Header:<br>  Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00<br>  Class:                             ELF32<br>  Data:                              2's complement, little endian<br>  Version:                           1 (current)<br>  OS/ABI:                            UNIX - System V<br>  ABI Version:                       0<br>  Type:                              EXEC (Executable file)<br>  Machine:                           Intel 80386<br>  Version:                           0x1<br>  Entry point address:               0x8048110<br></pre>First block:<br><a href="https://lh5.googleusercontent.com/-pNlhNxRYlkw/VCli6CE37KI/AAAAAAAARE8/HIUM16CdTbs/s720/010.png"><img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/010.png"></a> <p>Various analysis can resulted to the payload was coded in C, hmm..a quality up, we have a challenger here :) A new DDoS'er made in China. Here's the codes (for future reference): </p><pre class="brush: c">'crtstuff.c'<br>'autorun.c'<br>'crc32.c'<br>'encrypt.c'<br>'execpacket.c'<br>'buildnet.c'<br>'hide.c'<br>'http.c'<br>'kill.c'<br>'main.c'<br>'proc.c'<br>'socket.c'<br>'tcp.c'<br>'thread.c'<br>'findip.c'<br>'dns.c'  <br></pre>Some pointers for characteristic:  <p><i>Self copy:</i></p><pre class="brush: c">// create file for self-copy<br>open("/boot/[a-z]{10}", O_WRONLY|O_CREAT, 0400)<br>open("/boot/[a-z]{10}", O_WRONLY)<br><br>//chmod 755<br>chmod("/boot/[a-z]{10}", 0750)<br><br>// start to write..<br>open("/boot/[a-z]{10}", O_RDONLY)<br></pre><i>Auto start: </i><pre class="brush: asm">// install SYS<br><br>.text:0x8048B2E   mov     dword ptr [esp], offset aSbinInsmod &lt;== "/sbin/insmod"<br>.text:0x8048B35   call    LinuxExec_Argv<br>.text:0x8048B3A   mov     dword ptr [esp], 2<br>.text:0x8048B41   call    sleep<br><br>// xinetd setup..<br><br>.text:0x8048852   call    abstract_file_name<br>.text:0x8048857   mov     [ebp+var_8], eax<br>.text:0x804885A   mov     eax, [ebp+arg_0]<br>.text:0x804885D   mov     [esp+0Ch], eax<br>.text:0x8048861   mov     dword ptr [esp+8], offset aBinShS &lt;== "#!/bin/sh\n%s\n"<br>.text:0x8048869   mov     dword ptr [esp+4], 400h<br>.text:0x8048871   lea     eax, [ebp+newpath]<br>.text:0x8048877   mov     [esp], eax<br>.text:0x804887A   call    snprintf<br>   :<br>.text:0x804887F   mov     eax, [ebp+var_8]<br>.text:0x8048882   mov     [esp+0Ch], eax<br>.text:0x8048886   mov     dword ptr [esp+8], offset aEtcInit_dS &lt;== "/etc/init.d/%s"<br>.text:0x804888E   mov     dword ptr [esp+4], 400h<br>.text:0x8048896   lea     eax, [ebp+filename]<br>.text:0x804889C   mov     [esp], eax<br>.text:0x804889F   call    snprintf<br>.text:0x80488A4   mov     dword ptr [esp+4], offset aW &lt;== "w"<br>.text:0x80488AC   lea     eax, [ebp+filename]<br>.text:0x80488B2   mov     [esp], eax<br>.text:0x80488B5   call    fopen<br>   :<br>.text:0x8048980   mov     dword ptr [esp+8], offset aEtcRcD_dS90S &lt;== "/etc/rc%d.d/S90%s"<br>.text:0x8048988   mov     dword ptr [esp+4], 400h<br>.text:0x8048990   lea     eax, [ebp+newpath]<br>.text:0x8048996   mov     [esp], eax<br>.text:0x8048999   call    "snprintf"<br>.text:0x804899E   lea     eax, [ebp+newpath]  // assemble flag component for file attribs<br>.text:0x80489A4   mov     [esp], eax      &lt;== "filename"<br>.text:0x80489A7   call    "unlink"<br>.text:0x80489AC   lea     eax, [ebp+newpath]<br>.text:0x80489B2   mov     [esp+4], eax    &lt;== "newpath"<br>.text:0x80489B6   lea     eax, [ebp+filename]<br>.text:0x80489BC   mov     [esp], eax      &lt;== "oldpath"<br>.text:0x80489BF   call    "symlink"<br>.text:0x80489C4   cmp     [ebp+var_C], 0<br>.text:0x80489C8   jnz     short loc_80489E8<br>.text:0x80489CA   mov     dword ptr [esp+8], 0AD1473B8h &lt;== "group"<br>.text:0x80489D2   mov     dword ptr [esp+4], 0AD1473B8h &lt;== "owner"<br>.text:0x80489DA   lea     eax, [ebp+filename]<br>.text:0x80489E0   mov     [esp], eax      &lt;== "filename"<br>.text:0x80489E3   call    "lchown"</pre><i>Malicious environment setup (i.e. export cmd):</i><pre class="brush: asm">0x06988C   HOME=/<br>0x069893   HISTFILE=/dev/null<br>0x0698A6   MYSQL_HISTFILE=/dev/null<br>0x0698C0   PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin</pre> <p><i>Encryption:</i> </p><p>There are some encryption to be decrypted in this malware, that I tested as per below, that looks having xor pattern: </p><pre class="brush: asm">// checking decryptor...<br><br>.text:0x804CB63   mov   dword ptr [esp+4], offset aM_Nfr7nlqqgf_0<br>.text:0x804CB6B   lea   eax, [ebp+filename]<br>.text:0x804CB71   mov   [esp], eax<br>.text:0x804CB74   call  dec_conf           // decrypting function..<br>.text:0x804CB79   mov   dword ptr [esp+8], 0Ch // &lt;== break it here..<br><br>Breakpoint 1, 0x0804cb79 in main ()<br>query offset aM_Nfr7nlqqgf_0: "m.[$nFR$7nLQQGF"<br>query register: $esp<br>0xffffa1b0:  "[\305\377\377\343\033\v\b\020"<br>;-----------------------<br>.text:0x804CB81   mov    dword ptr [esp+4], offset aM_Nfr7n9_0<br>.text:0x804CB89   lea    eax, [ebp+var_114D]<br>.text:0x804CB8F   mov    [esp], eax<br>.text:0x804CB92   call   dec_conf<br><br>Breakpoint 2, 0x0804cb9 in main ()<br>query offset aM_Nfr7n9_0: "m.[$nFR$7n9"<br>query register: $esp<br>0xffffa1b0:  "[\304\377\377\363\033\v\b\f"<br>;-----------------------<br>.text:0x804CBBD   mov    dword ptr [esp+4], offset aM4s4nacNa ; "m4S4nAC/nA"<br>.text:0x804CBC5   lea    eax, [ebp+var_E4D]<br>.text:0x804CBCB   mov    [esp], eax<br>.text:0x804CBCE   call   dec_conf<br>.text:0x804CBD3   mov    [ebp+var_34], 0<br><br>Breakpoint 3, 0x0804cbd3 in main ()<br>query offset aM4s4nacNa ; "m4S4nAC/nA"<br>query register: $esp<br>0xffffa1b0:  "[\307\377\377#\034\v\b\v"<br></pre>Here is the xor used as the component logic for the decryption function:<br><a href="https://lh3.googleusercontent.com/-vqCsZsmIxp8/VCli6Fqhv0I/AAAAAAAARE0/ciC6amF5NOA/s1576/011.png"><img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/011.png"></a><br>With the key that lead to this address:<br><a href="https://lh6.googleusercontent.com/-GwkrnF3Q7no/VCli7BEATuI/AAAAAAAARFI/UM_iSIP6X1Y/s1858/014.png"><img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/014.png"></a><br>It "looks like" the author is having "interesting" way to remind him the XOR key itself, I don't investigate this further since I had the goal..<br><a href="https://lh5.googleusercontent.com/-zEGwgW36Xrg/VCli6JKLuOI/AAAAAAAARFE/pSH5FbJT7_k/s1576/012.png"><img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/012.png"></a><br> <p><i>A hard-coded callback IP address</i> </p><p>And look what I got next to the xor key :))<br><a href="https://lh3.googleusercontent.com/-CsuRbJiLdjY/VCli69RmtlI/AAAAAAAARFM/kd4yBAPyWPE/s1858/013.png"><img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/013.png"></a><br>So now we know the CNC is too ;) </p><pre class="brush: asm">IP: 103.25.9.228||59270 | 103.25.9.0/24 | CLOUD <br>Country: "HK | CLOUDRELY.COM" |CLOUD RELY LIMITED</pre> <p>The bummer part of this malware is, it crashed itself when run under limited permission...<br></p><pre class="brush: asm">"msec   calls "<br>-----------------------------------------------------------------------<br>(120): execve("./SAMPLE-MALWARE", ["./SAMPLE-MALWARE"], ["SHELL=etc..])<br>(125): set_thread_area(0xffc8373c)<br>(126): set_tid_address(0x92e6888)<br>(127): set_robust_list(0x92e6890, 0xc)<br>(128): futex(0xffc83a04, FUTEX_WAKE_PRIVATE, 1)<br>(129): rt_sigaction(SIGRTMIN, {0x8053860, [], SA_SIGINFO}, NULL, 8)<br>(130): rt_sigaction(SIGRT_1, {0x8053780, [], SA_RESTART|SA_SIGINFO}, NULL, 8)<br>(131): rt_sigprocmask(SIG_UNBLOCK, [RTMIN RT_1], NULL, 8)<br>(132): getrlimit(RLIMIT_STACK,etc)<br>(133): uname({sysname="Linux", nodename="mmd", release="mmd-amd64", <br>             version="#1 SMP mmd-7u1", machine="saever-momma"})<br>(142): readlink("/proc/self/exe", "/home/mmd/test/SAMPLE-MALWARE", 1023)<br>(143): clone(Process)<br>(145): exit_group(0)<br>(146): [pid new] setsid()<br>(147): open("/dev/null", O_RDWR)<br>(148): fstat64(3, {st_dev=makedev] etc) <br>(149): dup2(3, 0)<br>(150): dup2(3, 1)<br>(151): dup2(3, 2)<br>(152): close(3)<br>(153): readlink("/proc/self/exe", "/home/mmd/test/SAMPLE-MALWARE", 1023) = 20<br>(154): stat64("/boot" etc)<br>(155): stat64("/lib", etc)<br>(156): stat64("/lib/udev" etc)<br>(157): stat64("/var", etc)<br>(158): stat64("/var/run", etc)<br>(159): gettimeofday({1411989055, 135168}, NULL) <br>(160): readlink("/proc/self/exe", "/home/mmd/test/SAMPLE-MALWARE", 1023) <br>(161): unlink("/lib/udev/udev") <br>(162): open("/home/mmd/test/SAMPLE-MALWARE", O_RDONLY)<br>(163): open("/lib/udev/udev", O_WRONLY|O_CREAT, 0400)<br>(165): open("/home/mmd/test/SAMPLE-MALWARE", O_RDONLY)<br>(166): open("/boot/[a-z]{10}", O_WRONLY|O_CREAT, 0400)<br>(168): open("/boot/[a-z]{10}", O_WRONLY)<br>(169): clone(Process attached<br>(171): waitpid(Process suspended<br>(173): clone(Process attached<br>(175): exit_group(0)<br>(179): rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8)<br>(180): rt_sigaction(SIGCHLD, NULL, {SIG_IGN, [CHLD], SA_RESTART}, 8)<br>(181): nanosleep({1, 0},..<br>(192): chmod("/boot/[a-z]{10}", 0750)<br>(193): open("/boot/[a-z]{10}", O_RDONLY)<br>(194): "--- SIGSEGV (Segmentation fault) @ 0 (0)" --- ref: [a-z]{10}<br>(197): "rt_sigprocmask(SIG_SETMASK, [], NULL, 8)"</pre>It saves the file in <b><i>/boot</i></b> with this regex: <b>[a-z]{10}</b> <p></p><h2>What is the purpose of this malware?</h2><p>The first is backdoor, and then, obviously DoS (SYN, UDP, TCP flood), using encrypted (temporary) config. Below is the PoC of the DDoS function names: </p><pre class="brush: asm">0x09305E   build_syn // SYN Flood<br>0x0950D0   build_tcphdr // TCP Flood<br>0x097101   build_udphdr // UDP FLood<br></pre>And below is part of backdoor operation using HTTP/1.1 GET (to download / update) and callback in HTTP/1.1 POST: <pre class="brush: asm">.text:0x804A917   mov   dword ptr [esp+8], offset aPostSHttp1_1Sh<br>                        value: "POST %s HTTP/1.1\r\n%sHost: %s\r\nContent-T"<br>.text:0x804AB1D   mov   dword ptr [esp+8], offset aGetSHttp1_1Sho<br>                        value: "GET %s HTTP/1.1\r\n%sHost: %s\r\n%s"<br></pre>Based on the code it looks like using AES.DDoS'er and IptabLes strategy to install, but the source are different. So, this is another new China DDoS'er, I call this as <b>Linux/XOR.DDoS</b>.  <p></p><h2>Virus Total and sample</h2><p>Virus total detection is below (click the image to access..) One of 55 is a bad detection.. <a href="https://www.virustotal.com/en/file/834eb864a29471d0abe178068c259470e4403eb546554247e2f5832acf9586ab/analysis/1411743709/"><img src="./MMD-0028-2014 - Linux_XOR.DDoS _ Fuzzy reversing a new China ELF · MalwareMustDie!_files/015.png"></a></p><p>Sample is shared in kernel mode--&gt;[<a href="http://www.kernelmode.info/forum/viewtopic.php?f=16&amp;t=3509">here</a>]  </p><p></p><h2>Conclusion &amp; Credits</h2><p>This threat is the first time we see using complicated installer/builder. I and other team mates start to feel like playing CTF with this crook. They (China actors) are improving in steps, we must be aware. Please stay safe folks.. </p><p>Credit: @shibumi (threat sensoring), @wirehack7 (formulation), and others who doesn't want to be mentioned.  </p><p></p><h2>Additional</h2><p>(A reserved section for additional and updates)  </p><p>#MalwareMustDie!!
</p></div>

<div class="related">
  <h2>Recent Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="http://blog.malwaremustdie.org/2017/02/mmd-0062-2017-ssh-direct-tcp-forward-attack.html">
            MMD-0062-2017 - Credential harvesting by SSH Direct TCP Forward attack via IoT botnet
            <small>27 Feb 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://blog.malwaremustdie.org/2016/11/mmd-0061-2016-emech-for-ddos.html">
            MMD-0061-2016 - EnergyMech 2.8 overkill mod
            <small>28 Nov 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://blog.malwaremustdie.org/2016/11/linux-malware.html">
            Linux Malware Research List Updated
            <small>22 Nov 2016</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  

</body></html>